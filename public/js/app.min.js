let e,t="IntersectionObserver"in window;function o(){t&&(e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const o=t.target;o.dataset.src&&(o.src=o.dataset.src,o.removeAttribute("data-src"),e.unobserve(o))}})},{rootMargin:"50px 0px",threshold:.1}))}function n(){t&&document.querySelectorAll("img[data-src]").forEach(t=>e.observe(t))}function a(){["/data/1)klasifikace_vegetace-Vraclav/uzemi.webp","/data/2)klasifikace_spaleneho_porostu-Albanie/uzemi.webp","/data/3)klasifikace_poskozeni_obilnin-Loucky/uzemi.webp"].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,document.head.appendChild(t)})}let i=new Map,c=[],r=[],l=!1,d=0;const u=150;let s=!1,m=0;function p(e,t){if("image-overlay"===t&&void 0!==w&&null===w)return;const o=Date.now();r=r.filter(e=>e.key!==t),r.push({operation:e,key:t,timestamp:o}),b()}function b(){if(l||0===r.length)return;const e=Date.now();if(e-d<u)return void setTimeout(b,u-(e-d));l=!0;const t=r.shift();try{t.operation(),d=Date.now()}catch(e){console.error("Operation failed:",e)}finally{l=!1,r.length>0&&setTimeout(b,u)}}export function cleanupMemory(){c=[],w=null,g=0,f=0,y=0,h=0,I=!1,O=!1,r=[],l=!1,d=0,i.size>200&&i.clear(),window.gc&&window.gc()}export function loadImageOptimized(e){if(i.has(e))return i.get(e);const t=new Image;return t.src=e,i.set(e,t),t}export function showOverlay(e){document.getElementById("overlayFrame").src=e,document.getElementById("overlay").style.display="block"}export function hideOverlay(){document.getElementById("overlayFrame").src="",document.getElementById("overlay").style.display="none",cleanupMemory()}const v=JSON.parse(document.getElementById("caseStudiesData").textContent);window.data=v,v.length;let w=null,g=0,f=0,y=0,h=0,I=!1,O=!1,x=!1,B=null,k=0,T=!1;export function showImageOverlay(e,t,o){const n=v.find(t=>t.name===e);if(!n)return;if(!n.methods||!n.methods[t])return;const a=n.methods[t];a.images&&a.images[o]&&(w=n,g=t,f=o,I=!1,O=!1,p(()=>updateImageOverlay(),"image-overlay"),updateNavButtonLabels(),document.getElementById("imageOverlay").style.display="block",window.innerWidth<=768&&hideBubbles())}export function toggleOverviewImages(e){const t=v.find(t=>t.name===e);t&&(w=t,f=0,I=!0,O=!1,p(()=>updateImageOverlay(),"image-overlay"),updateNavButtonLabels(),document.getElementById("imageOverlay").style.display="block",window.innerWidth<=768&&hideBubbles())}export function hideImageOverlay(){s=!1,document.getElementById("imageOverlay").style.display="none",I=!1,O=!1,showBubbles()}export function toggleCompareWithCrop(){I||(O=!O,p(()=>updateImageOverlay(),"image-overlay"),updateCompareButtonText())}export function updateImageOverlay(){if(w)try{const e=document.getElementById("overlayImg"),t=document.getElementById("imageOverlay");if(!e||!t)return;let o=null;if(I){if(!w.overview||!w.overview[f])return;const e=w.overview[f];o=`/data/${w.name}/${e}`;const n=document.getElementById("methodIndicator");n&&(n.textContent=e.replace(".webp","")),t.classList.remove("compare-mode"),c=[o]}else{if(!w.methods||!w.methods[g])return;const n=w.methods[g];if(!n.images||!n.images[f])return;const a=n.images[f];O?(o=`/data/${w.name}/vysec.webp`,e.alt="Výřez",t.classList.add("compare-mode"),c=[`/${a.fullPath}`,`/data/${w.name}/vysec.webp`]):(o=`/${a.fullPath}`,e.alt="",t.classList.remove("compare-mode"),c=[o]);let i="";a.filename.includes("_rgb")?i=" (RGB)":a.filename.includes("_tgi")&&(i=" (TGI)");const r=document.getElementById("methodIndicator");r&&(r.textContent=`${n.name}${i}`)}if(o){s=!0;const t=++m,n=new window.Image;let a=setTimeout(()=>{t===m&&(s=!1,console.error("Image load timeout:",{newSrc:o,thisRequestId:t,lastImageRequestId:m,isImageLoading:s}),updateCompareButtonText(),w&&updateImageOverlay())},5e3);n.onload=()=>{clearTimeout(a),t===m&&(e.src=encodeURI(o),s=!1,updateCompareButtonText(),updateNavButtonLabels())},n.onerror=()=>{clearTimeout(a),t===m&&(s=!1,console.error("Image failed to load:",o),updateCompareButtonText())},n.src=o}}catch(e){s=!1,console.error("updateImageOverlay error",e)}}export function updateCompareButtonText(){try{const e=document.querySelector(".compare-button");if(e){const t=e.querySelector(".nav-button-label");t&&(t.textContent=O?"Zobrazit metodu":"Zobrazit výřez")}}catch(e){console.error("Error in updateCompareButtonText:",e)}}export function updateNavButtonLabels(){try{document.querySelectorAll(".nav-button").forEach(e=>{const t=e.querySelector(".nav-button-label");t&&(e.onclick.toString().includes("navigateImage(-1)")?t.textContent="Předchozí index":e.onclick.toString().includes("navigateImage(1)")?t.textContent="Další index":e.onclick.toString().includes("navigateMethod(-1)")?t.textContent="Předchozí metoda":e.onclick.toString().includes("navigateMethod(1)")&&(t.textContent="Další metoda"))})}catch(e){console.error("Error in updateNavButtonLabels:",e)}}function $(){return w||(window.data&&window.data.length>0?(w=window.data[0],g=0,f=0,console.warn("currentStudy was null, fallback to first study"),w):(alert("Nastala chyba: žádná platná studie není k dispozici. Načtěte stránku znovu."),window.location.reload(),null))}export function navigateImage(e){if($()){if(O)return O=!1,p(()=>updateImageOverlay(),"image-overlay"),void updateCompareButtonText();if(I){if(w.overview&&w.overview.length>0){let t=(f+e+w.overview.length)%w.overview.length;(t<0||t>=w.overview.length)&&(t=0),f=t}}else{if(!w.methods||!w.methods[g])return;const t=w.methods[g];if(t.images&&t.images.length>0){let o=(f+e+t.images.length)%t.images.length;(o<0||o>=t.images.length)&&(o=0),f=o}}p(()=>updateImageOverlay(),"image-overlay")}}export function navigateMethod(e){if(I||!$())return;if(O)return O=!1,p(()=>updateImageOverlay(),"image-overlay"),void updateCompareButtonText();if(!w.methods||!w.methods.length)return;let t=(g+e+w.methods.length)%w.methods.length;(t<0||t>=w.methods.length)&&(t=0),g=t,f=0,p(()=>updateImageOverlay(),"image-overlay")}export function toggleTableGraph(e,t,o){const n=e.closest(".table-item");if(!n)return;n.dataset.isTable;const a=parseInt(n.dataset.currentIndex)||0,i=JSON.parse(n.dataset.tables||"[]"),c=JSON.parse(n.dataset.graphs||"[]"),r=[...i,...c];if(r.length>1){const t=(a+1)%r.length;e.src="/"+r[t],n.dataset.currentIndex=t;const o=r[t],c=i.includes(o);n.dataset.isTable=c.toString();const l=n.querySelector("div");l&&(l.textContent=c?"Klikněte pro přepnutí na graf":"Klikněte pro přepnutí na tabulku")}}export function hideTablesOverlay(){document.getElementById("tablesOverlay").style.display="none",showBubbles()}export function showIndicesOverlay(e){const t=v.find(t=>t.name===e);t&&t.indices&&t.indices.length&&(B=t,k=0,T=!1,z(),updateIndicesRGBButtonText(),document.getElementById("indicesOverlay").style.display="block",window.innerWidth<=768&&hideBubbles())}export function hideIndicesOverlay(){document.getElementById("indicesOverlay").style.display="none",B=null,k=0,T=!1,showBubbles()}export function navigateIndices(e){B&&B.indices.length&&(k=(k+e+B.indices.length)%B.indices.length,T=!1,z(),updateIndicesRGBButtonText())}function z(){if(!B)return;const e=document.getElementById("indicesOverlayImg"),t=document.getElementById("indicesIndicator"),o=document.getElementById("indicesOverlay");if(T)e.src=`/data/${B.name}/indices/rgb.webp`,t.textContent="RGB",o.classList.add("compare-mode");else{const n=B.indices[k];e.src=`/data/${B.name}/indices/${n}`,t.textContent=n.replace(".webp",""),o.classList.remove("compare-mode")}}export function toggleIndicesRGB(){T=!T,z(),updateIndicesRGBButtonText()}export function updateIndicesRGBButtonText(){try{const e=document.querySelector("#indicesOverlay .compare-button");if(e){const t=e.querySelector(".nav-button-label");t&&(t.textContent=T?"Zobrazit index":"Zobrazit RGB")}}catch(e){console.error("Error in updateIndicesRGBButtonText:",e)}}export function showTablesOverlay(e){if(w=v.find(t=>t.name===e),y=0,w&&w.tables&&w.tables.length>0){const t=document.querySelector(".tables-container");t.innerHTML="";const o={};w.tables.forEach(e=>{const t=e.filename;let n="",a="";t.includes("_tabulka")?(n=t.replace("_tabulka.webp",""),a="table"):t.includes("_graf")&&(n=t.replace(/_graf\d*\.webp$/,""),a="graph"),n&&(o[n]||(o[n]={tables:[],graphs:[]}),"table"===a?o[n].tables.push(e):"graph"===a&&o[n].graphs.push(e))}),Object.keys(o).forEach(n=>{const a=o[n],i=document.createElement("div");i.className="table-item";const c=a.tables.length>0?a.tables[0]:a.graphs[0],r=a.graphs.length>0,l=a.tables.length>0,d=r&&l;i.innerHTML=`\n        <img src="/${c.fullPath}" alt="${c.filename}" \n             ${d?"onclick=\"toggleTableGraph(this, '"+n+"', '"+e+'\')" style="cursor: pointer;"':""} />\n        ${d?'<div style="text-align: center; margin-top: 0.5rem; font-size: 0.9rem; color: #666;">Klikněte pro přepnutí na graf</div>':""}\n      `,i.dataset.baseName=n,i.dataset.studyName=e,i.dataset.currentIndex="0",i.dataset.isTable="true",i.dataset.tables=JSON.stringify(a.tables.map(e=>e.fullPath)),i.dataset.graphs=JSON.stringify(a.graphs.map(e=>e.fullPath)),t.appendChild(i)});const n=document.getElementById("tablesIndicator");n&&(n.textContent="");const a=document.querySelector(".tables-overlay-content");let i=a.querySelector(".tables-mobile-title");i||(i=document.createElement("div"),i.className="tables-mobile-title",a.insertBefore(i,a.firstChild)),i.textContent=w&&w.title?w.title:e,document.getElementById("tablesOverlay").style.display="block",window.innerWidth<=768&&hideBubbles()}}export function setupMobileBubbleToggle(e,t){document.querySelectorAll(e).forEach(o=>{const n=o.querySelector(t),a=o.querySelector(".bubble-icon");a&&n&&(a.mobileClickHandler&&a.removeEventListener("click",a.mobileClickHandler),a.mobileClickHandler=function(t){p(()=>{window.innerWidth<=768&&(t.stopPropagation(),"block"===n.style.display?(n.style.setProperty("display","none","important"),n.style.setProperty("opacity","0","important"),n.style.setProperty("visibility","hidden","important")):(document.querySelectorAll(".bubble-content").forEach(e=>{e!==n&&(e.style.setProperty("display","none","important"),e.style.setProperty("opacity","0","important"),e.style.setProperty("visibility","hidden","important"))}),n.style.setProperty("display","block","important"),n.style.setProperty("opacity","1","important"),n.style.setProperty("visibility","visible","important"),n.style.setProperty("transform","translateY(0)","important")))},`bubble-toggle-${e}`)},a.addEventListener("click",a.mobileClickHandler),n.hasClickHandler||(n.addEventListener("click",function(e){window.innerWidth<=768&&e.stopPropagation()}),n.hasClickHandler=!0))}),document.mobileBubbleCloseHandler&&document.removeEventListener("click",document.mobileBubbleCloseHandler),document.mobileBubbleCloseHandler=function(e){p(()=>{window.innerWidth<=768&&document.querySelectorAll(".bubble-content").forEach(e=>{e.style.setProperty("display","none","important"),e.style.setProperty("opacity","0","important"),e.style.setProperty("visibility","hidden","important")})},"bubble-close-global")},document.addEventListener("click",document.mobileBubbleCloseHandler)}export function hideBubbles(){document.querySelectorAll(".bubble").forEach(e=>{e.style.display="none"})}export function showBubbles(){document.querySelectorAll(".bubble").forEach(e=>{e.style.display="flex"})}document.addEventListener("DOMContentLoaded",function(){o(),a(),n();const e=window.location.pathname;document.querySelectorAll(".study-nav a").forEach(t=>{t.classList.remove("active"),t.getAttribute("href")===e&&t.classList.add("active")}),setupMobileBubbleToggle(".help-bubble",".help-content"),setupMobileBubbleToggle(".info-bubble",".info-content"),"performance"in window&&window.addEventListener("load",()=>{const e=performance.getEntriesByType("navigation")[0];e.loadEventEnd,e.loadEventStart})}),window.addEventListener("beforeunload",function(){r=[],l=!1,i.clear(),c=[]}),document.addEventListener("visibilitychange",function(){document.hidden&&(r=[],l=!1)}),window.showOverlay=showOverlay,window.hideOverlay=hideOverlay,window.showImageOverlay=showImageOverlay,window.toggleOverviewImages=toggleOverviewImages,window.toggleMainImages=toggleMainImages,window.hideImageOverlay=hideImageOverlay,window.navigateImage=navigateImage,window.navigateMethod=navigateMethod,window.toggleTableGraph=toggleTableGraph,window.hideTablesOverlay=hideTablesOverlay,window.toggleCompareWithCrop=toggleCompareWithCrop,window.updateCompareButtonText=updateCompareButtonText,window.showTablesOverlay=showTablesOverlay,window.showIndicesOverlay=showIndicesOverlay,window.hideIndicesOverlay=hideIndicesOverlay,window.navigateIndices=navigateIndices,window.toggleIndicesRGB=toggleIndicesRGB,window.updateIndicesRGBButtonText=updateIndicesRGBButtonText,window.updateNavButtonLabels=updateNavButtonLabels;export function toggleMainImages(e){v.find(t=>t.name===e);const t=event.currentTarget,o=t.querySelectorAll(".overview-image"),n=t.querySelector(".overview-image.visible");if(!n||o.length<=1)return;const a=(Array.from(o).indexOf(n)+1)%o.length;n.classList.remove("visible"),n.classList.add("hidden"),o[a].classList.remove("hidden"),o[a].classList.add("visible")}